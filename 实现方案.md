# 老师-学生谈话记录小程序 实现方案

> **基于**: 设计方案v1.1.md

---

## 项目概述

开发一个用于记录老师与学生谈话的微信小程序，包含4个核心页面和对应的后端API服务。

### 技术栈
- **前端**: Vue 3 + Vite + uni-app + uView-Plus 3.x + **TypeScript**
- **后端**: Node.js + Next.js 14+ (App Router) + **TypeScript**
- **数据库**: MySQL 8.0 (Docker)
- **ORM**: Prisma
- **容器化**: Docker + Docker Compose
- **语言**: TypeScript (前后端统一)

---

## Proposed Changes

### 后端项目 (backend/)

#### [NEW] [package.json](file:///d:/Code_Repository/studentTalk/backend/package.json)
- Next.js 14 项目配置
- 依赖: prisma, mysql2, @prisma/client

#### [NEW] [prisma/schema.prisma](file:///d:/Code_Repository/studentTalk/backend/prisma/schema.prisma)
- 定义数据模型: TalkRecord, QuickTag, QuickTagDetail
- 配置 MySQL 数据源

#### [NEW] [src/app/api/v1/record/route.ts](file:///d:/Code_Repository/studentTalk/backend/src/app/api/v1/record/route.ts)
- GET: 获取记录列表（分页、按姓名搜索）
- POST: 创建新记录

#### [NEW] [src/app/api/v1/record/[id]/route.ts](file:///d:/Code_Repository/studentTalk/backend/src/app/api/v1/record/%5Bid%5D/route.ts)
- GET: 获取记录详情
- DELETE: 删除记录

#### [NEW] [src/app/api/v1/quick-tag/route.ts](file:///d:/Code_Repository/studentTalk/backend/src/app/api/v1/quick-tag/route.ts)
- GET: 获取所有类别及其明细列表

#### [NEW] [src/app/api/v1/quick-tag/[id]/details/route.ts](file:///d:/Code_Repository/studentTalk/backend/src/app/api/v1/quick-tag/%5Bid%5D/details/route.ts)
- GET: 获取指定类别的明细列表

#### [NEW] [src/app/api/v1/quick-tag/[id]/detail/route.ts](file:///d:/Code_Repository/studentTalk/backend/src/app/api/v1/quick-tag/%5Bid%5D/detail/route.ts)
- POST: 添加标签明细

#### [NEW] [src/app/api/v1/quick-tag/detail/[detailId]/route.ts](file:///d:/Code_Repository/studentTalk/backend/src/app/api/v1/quick-tag/detail/%5BdetailId%5D/route.ts)
- DELETE: 删除标签明细

#### [NEW] [src/lib/prisma.ts](file:///d:/Code_Repository/studentTalk/backend/src/lib/prisma.ts)
- Prisma Client 单例封装

#### [NEW] [src/lib/response.ts](file:///d:/Code_Repository/studentTalk/backend/src/lib/response.ts)
- 统一响应格式封装

---

### 前端项目 (frontend/)

#### [NEW] [package.json](file:///d:/Code_Repository/studentTalk/frontend/package.json)
- uni-app + Vue 3 + Vite 项目配置
- 依赖: uview-plus, pinia, typescript

#### [NEW] [src/pages.json](file:///d:/Code_Repository/studentTalk/frontend/src/pages.json)
- 页面路由配置
- TabBar 配置（记录列表、新增记录、快捷标签）

#### [NEW] [src/api/index.ts](file:///d:/Code_Repository/studentTalk/frontend/src/api/index.ts)
- 统一请求封装
- API 接口定义

#### [NEW] [src/pages/record-list/index.vue](file:///d:/Code_Repository/studentTalk/frontend/src/pages/record-list/index.vue)
- 记录列表页
- 搜索、分页加载、下拉刷新

#### [NEW] [src/pages/record-add/index.vue](file:///d:/Code_Repository/studentTalk/frontend/src/pages/record-add/index.vue)
- 新增记录页
- 表单字段（复选框+自定义输入）
- 模板生成逻辑

#### [NEW] [src/pages/record-detail/index.vue](file:///d:/Code_Repository/studentTalk/frontend/src/pages/record-detail/index.vue)
- 记录详情页
- 复制、删除功能

#### [NEW] [src/pages/quick-tag/index.vue](file:///d:/Code_Repository/studentTalk/frontend/src/pages/quick-tag/index.vue)
- 快捷标签配置页
- 添加、删除标签

---

### Docker 配置

#### [NEW] [docker-compose.yml](file:///d:/Code_Repository/studentTalk/docker-compose.yml)
- MySQL 8.0 服务
- 后端服务
- 数据卷配置

#### [NEW] [init.sql](file:///d:/Code_Repository/studentTalk/init.sql)
- 数据库初始化脚本
- 创建表结构
- 初始化默认快捷标签数据

#### [NEW] [backend/Dockerfile](file:///d:/Code_Repository/studentTalk/backend/Dockerfile)
- Next.js 生产构建配置

---

## Verification Plan

### 自动化测试

#### 1. 后端 API 测试
启动服务后，使用 curl 测试 API 接口:

```bash
# 在 backend 目录下启动开发服务
cd d:\Code_Repository\studentTalk\backend
npm run dev

# 测试获取快捷标签
curl http://localhost:3000/api/v1/quick-tag

# 测试创建记录
curl -X POST http://localhost:3000/api/v1/record \
  -H "Content-Type: application/json" \
  -d '{"student_name":"测试学生","class_name":"7年级1班","student_no":"20260101","talk_time":"2026-01-24 10:00:00","talk_place":"办公室","participants":"班主任","reason":"迟到","raw_text":"测试原始内容","form_data":{},"record_date":"2026-01-24"}'

# 测试获取记录列表
curl "http://localhost:3000/api/v1/record?page=1&size=10"
```

#### 2. 数据库连接测试
```bash
# 启动 Docker 容器
cd d:\Code_Repository\studentTalk
docker-compose up -d mysql

# 验证 MySQL 启动
docker exec -it talk-record-mysql mysql -uapp -papp123456 -e "SELECT * FROM quick_tag;"
```

### 手动验证

#### 1. 前端页面功能测试
1. 启动前端开发服务: `npm run dev:mp-weixin`
2. 使用微信开发者工具打开 `frontend/dist/dev/mp-weixin` 目录
3. 测试以下功能:
   - 记录列表页: 搜索、下拉刷新、点击进入详情
   - 新增记录页: 填写表单、复选框选择、提交保存
   - 记录详情页: 查看详情、复制文本、删除记录
   - 快捷标签页: 添加标签、删除标签

#### 2. H5 预览测试
由于无法直接验证微信小程序，可使用 H5 模式预览:
```bash
cd d:\Code_Repository\studentTalk\frontend
npm run dev:h5
```
访问 http://localhost:5173 进行基础功能验证

---

## 实现顺序

1. **Phase 1**: 项目初始化、Docker/MySQL 配置
2. **Phase 2**: 后端 Prisma 模型 + API 路由
3. **Phase 3**: 前端 uni-app 项目 + 4个页面
4. **Phase 4**: 前后端联调测试
5. **Phase 5**: 完善文档和部署配置
