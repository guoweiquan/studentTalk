# 老师-学生谈话记录小程序 设计方案

> **版本**: v1.2  
> **更新日期**: 2026-01-24  
> **状态**: 设计阶段

---

## 1. 项目概述

### 1.1 项目背景
本项目旨在为教师提供一个简单高效的工具，用于记录与学生的谈话内容。通过模板化的方式自动生成规范的谈话记录文本，支持历史记录查询，帮助教师提升工作效率。

### 1.2 核心功能
| 功能模块 | 描述 |
| :--- | :--- |
| 谈话整理 | 原始谈话片段 - 结构化《学生谈话记录表》 - 规范记录文本 |
| 新增记录 | 录入或修订关键要素，生成规范文本并保存 |
| 快捷标签管理 | 配置各字段的备选标签，支持分号分隔批量录入 |
| 记录列表 | 按姓名搜索，分页展示历史记录 |
| 记录详情 | 查看完整记录，支持复制、删除操作 |



### 1.3 角色设定与任务定位
- 角色：你是一位拥有20年经验的资深班主任与学生心理辅导专家
- 任务：将用户输入的原始、凌乱谈话记录片段整理为结构化、符合学校行政要求的《学生谈话记录表》，并给出专业的后续建议

### 1.4 核心变更点
- ✅ 新增"原始谈话片段→结构化表单→规范记录文本"的整理流程
- ✅ 新增"快捷标签"一键补全能力（可配置推荐词库）
- ✅ 采用**模板拼接方式**输出规范记录文本（非自由生成）
- ✅ 去除登录与新用户注册功能
- ✅ 包含「新增」「列表」「详情」「快捷标签配置」四个核心页面

### 1.5 v1.2 版本变更点
- ✅ **表单字段交互优化**：参与人、事由/问题、学生态度/情绪、原因分析、处理与辅导措施、后续跟进计划改为**复选框+自定义输入**
- ✅ **风险等级单选框**：风险等级改为单选框（低/中/高固定选项）
- ✅ **新增快捷标签配置页**：采用列表管理模式，支持单个添加和删除标签
- ✅ **数据库设计优化**：采用主表(`quick_tag`)+明细表(`quick_tag_detail`)的一对多结构，明细表支持`is_active`状态字段
- ✅ **API接口优化**：支持按类别获取/添加/删除标签明细
- ✅ **数据联动**：快捷标签配置页的内容自动同步到新增记录页的复选框选项



---

## 2. 技术架构

### 2.1 技术栈总览

| 层级 | 技术选型 | 版本要求 |
| :--- | :--- | :--- |
| **前端框架** | Vue 3 + Vite | Vue 3.4+, Vite 5.x |
| **UI 组件库** | uView-Plus | 3.x |
| **小程序框架** | uni-app | 3.x |
| **后端框架** | Node.js + Next.js | Node 20+, Next.js 14+ |
| **数据库** | MySQL | 8.0+ |
| **容器化** | Docker + Docker Compose | 最新稳定版 |

### 2.2 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      微信小程序客户端                         │
│              (Vue 3 + Vite + uView-Plus)                    │
└──────────────────────────┬──────────────────────────────────┘
                           │ HTTPS
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     Next.js API Server                      │
│                  (Node.js + API Routes)                     │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐                                   │
│  │     记录模块        │                                   │
│  └─────────────────────┘                                   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    MySQL 8.0 (Docker)                       │
└─────────────────────────────────────────────────────────────┘
```


### 2.3 项目目录结构

```
project/
├── frontend/                    # 前端项目 (uni-app)
│   ├── src/
│   │   ├── pages/              # 页面文件
│   │   │   ├── record-add/     # 新增记录页
│   │   │   ├── record-list/    # 记录列表页
│   │   │   ├── record-detail/  # 记录详情页
│   │   │   └── quick-tag/      # 快捷标签配置页

│   │   ├── components/         # 公共组件
│   │   ├── api/                # API 接口封装
│   │   ├── store/              # 状态管理
│   │   └── utils/              # 工具函数
│   └── package.json
│
├── backend/                     # 后端项目 (Next.js)
│   ├── src/
│   │   ├── app/
│   │   │   └── api/            # API Routes
│   │   ├── lib/                # 公共库
│   │   └── services/           # 业务逻辑层
│   ├── prisma/                 # 数据库模型
│   └── package.json
│
├── docker-compose.yml          # Docker 编排文件
└── README.md
```

---

## 3. 页面详细设计



### 3.1 新增记录页 (Add Record)

老师的核心操作页，用于记录谈话内容。


#### 页面布局
```
┌────────────────────────────┐
│       新增谈话记录          │
├────────────────────────────┤
│  原始谈话片段 *             │
│  ┌────────────────────┐    │
│  │  粘贴凌乱谈话记录    │    │
│  └────────────────────┘    │
│  快捷标签（可点选）         │
│  [迟到] [作业缺交] [情绪波动] │
│  [亲子沟通] [同伴冲突] […]   │
│  基本信息 *                 │
│  ┌ 学生姓名/班级/学号 ┐      │
│  ┌ 谈话时间/地点/参与人 ┐     │
│  事由/问题 *               │
│  关键事实 *               │
│  学生态度/情绪 *           │
│  原因分析 *               │
│  处理与辅导措施 *          │
│  后续跟进计划 *           │
│  风险等级 *               │
├────────────────────────────┤
│  [  一键整理  ]  [提交保存] │
├────────────────────────────┤
│  ┌────────────────────┐    │
│  │ 【学生谈话记录表】    │    │
│  │ 结构化字段已填充…     │    │
│  └────────────────────┘    │
└────────────────────────────┘
```


#### 表单字段（结构化《学生谈话记录表》）
| 字段 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| 原始谈话片段 | Textarea | ✅ | 粘贴原始、凌乱的谈话记录 |
| 学生姓名 | Input | ✅ | 学生姓名 |
| 班级/学号 | Input | ✅ | 例如：7年级2班 / 202301 |
| 谈话时间 | DateTime | ✅ | 默认当前时间 |
| 谈话地点 | Input | ✅ | 办公室/教室等 |
| 参与人 | **Checkbox + Input** | ✅ | 从快捷标签加载选项，支持多选+自定义输入 |
| 事由/问题 | **Checkbox + Input** | ✅ | 从快捷标签加载选项，支持多选+自定义输入 |
| 关键事实 | Textarea | ✅ | 从原始片段中提取的要点 |
| 学生态度/情绪 | **Checkbox + Input** | ✅ | 从快捷标签加载选项，支持多选+自定义输入 |
| 原因分析 | **Checkbox + Input** | ✅ | 从快捷标签加载选项，支持多选+自定义输入 |
| 处理与辅导措施 | **Checkbox + Input** | ✅ | 从快捷标签加载选项，支持多选+自定义输入 |
| 后续跟进计划 | **Checkbox + Input** | ✅ | 从快捷标签加载选项，支持多选+自定义输入 |
| 风险等级 | **Radio** | ✅ | 单选：低/中/高（固定选项） |

#### 复选框 + 自定义输入 UI 示例
```
+------------------------------------+
| 事由/问题                           |
| [x] 迟到  [x] 作业缺交  [ ] 打架    |
| [ ] 情绪波动  [ ] 课堂纪律          |
| +--------------------------------+ |
| | 其他：请输入自定义内容...        | |
| +--------------------------------+ |
+------------------------------------+
```

#### 字段选项数据来源
- 复选框选项从**快捷标签配置表**中动态加载
- 用户在"快捷标签"页面录入的内容会自动解析并展示为可选项
- 自定义输入的内容将与选中的复选框内容合并保存
- 数据解析规则：使用英文分号 `;` 作为分隔符，自动去除首尾空格

#### 模板生成逻辑
- 系统从“原始谈话片段”中提取关键信息，自动填充结构化字段，老师可二次编辑
```
【学生谈话记录表】
学生姓名：{姓名}    班级/学号：{班级/学号}
谈话时间：{谈话时间}    地点：{谈话地点}    参与人：{参与人}
谈话事由：{事由/问题}
关键事实：{关键事实}
学生态度/情绪：{态度/情绪}
原因分析：{原因分析}
处理与辅导措施：{处理措施}
后续跟进计划：{跟进计划}
风险等级：{风险等级}
记录人：{老师姓名}
```


---

### 3.2 记录列表页 (Record List)


用于查阅历史谈话记录。

#### 页面布局
```
┌────────────────────────────┐
│  🔍 搜索学生姓名...         │
├────────────────────────────┤
│  ┌────────────────────┐    │
│  │ 张三    2026-01-23  │    │
│  │ 迟到，睡懒觉...      │    │
│  └────────────────────┘    │
│  ┌────────────────────┐    │
│  │ 李四    2026-01-22  │    │
│  │ 未完成作业，贪玩... │    │
│  └────────────────────┘    │
│  ┌────────────────────┐    │
│  │ 王五    2026-01-21  │    │
│  │ 打架，情绪失控...   │    │
│  └────────────────────┘    │
├────────────────────────────┤
│      ↓ 加载更多 ↓          │
└────────────────────────────┘
```

#### 功能说明
- **搜索框**：输入学生姓名进行模糊搜索
- **列表项**：
  - 第一行：学生姓名 | 记录日期 (YYYY-MM-DD)
  - 第二行：事由摘要（截取前20字...）
- **交互**：
  - 点击列表项 → 跳转至记录详情页
  - 下拉刷新、触底加载更多

---

### 3.3 记录详情页 (Record Detail)


展示单次谈话的完整档案。

#### 页面布局
```
┌────────────────────────────┐
│       ← 返回    记录详情     │
├────────────────────────────┤
│  学生姓名：张三              │
│  记录日期：2026-01-23       │
│  事    由：迟到              │
│  原    因：睡懒觉            │
│  学生表现：诚恳              │
│  处理结果：口头警告          │
├────────────────────────────┤
│  ┌────────────────────┐    │
│  │ 【谈话记录】         │    │
│  │ 谈话事由：本日针对张三 │    │
│  │ 同学迟到的行为进行了  │    │
│  │ 谈话。               │    │
│  │ 情况分析：经了解，核  │    │
│  │ 心原因为睡懒觉。谈话  │    │
│  │ 中学生表现诚恳。      │    │
│  │ 处置结果：口头警告。  │    │
│  └────────────────────┘    │
├────────────────────────────┤
│  [ 复制文本 ]   [ 删除记录 ] │
└────────────────────────────┘
```

#### 底部操作栏
| 按钮 | 功能 |
| :--- | :--- |
| 复制文本 | 将谈话记录复制到剪贴板 |
| 删除记录 | 二次确认后删除该条记录 |
| 编辑 (可选) | 跳转回新增页并回显数据 |

---

### 3.4 快捷标签配置页 (Quick Tag)

用于配置各字段的备选标签选项，采用列表管理模式，支持单个添加和删除。

#### 页面布局
```
┌─────────────────────────────────┐
│       快捷标签配置               │
├─────────────────────────────────┤
│  参与人                          │
│  +-----------------------------+│
│  | 班主任              [删除]  ││
│  | 任课老师            [删除]  ││
│  | 家长                [删除]  ││
│  +-----------------------------+│
│  ┌───────────────────┐ [添加]   │
│  │ 输入新标签值...    │          │
│  └───────────────────┘          │
│                                 │
│  事由/问题                       │
│  +-----------------------------+│
│  | 迟到                [删除]  ││
│  | 作业缺交            [删除]  ││
│  | 打架                [删除]  ││
│  | 情绪波动            [删除]  ││
│  +-----------------------------+│
│  ┌───────────────────┐ [添加]   │
│  │ 输入新标签值...    │          │
│  └───────────────────┘          │
│                                 │
│  学生态度/情绪                   │
│  +-----------------------------+│
│  | 诚恳                [删除]  ││
│  | 抵触                [删除]  ││
│  | 紧张                [删除]  ││
│  +-----------------------------+│
│  ┌───────────────────┐ [添加]   │
│  │ 输入新标签值...    │          │
│  └───────────────────┘          │
│                                 │
│  原因分析                        │
│  +-----------------------------+│
│  | 作息管理            [删除]  ││
│  | 家庭原因            [删除]  ││
│  +-----------------------------+│
│  ┌───────────────────┐ [添加]   │
│  │ 输入新标签值...    │          │
│  └───────────────────┘          │
│                                 │
│  处理与辅导措施                  │
│  +-----------------------------+│
│  | 口头警告            [删除]  ││
│  | 家校沟通            [删除]  ││
│  +-----------------------------+│
│  ┌───────────────────┐ [添加]   │
│  │ 输入新标签值...    │          │
│  └───────────────────┘          │
│                                 │
│  后续跟进计划                    │
│  +-----------------------------+│
│  | 一周后复谈          [删除]  ││
│  | 持续观察            [删除]  ││
│  +-----------------------------+│
│  ┌───────────────────┐ [添加]   │
│  │ 输入新标签值...    │          │
│  └───────────────────┘          │
└─────────────────────────────────┘
```

#### 固定类别（6个）
| 类别编码 | 类别名称 | 说明 |
| :--- | :--- | :--- |
| participants | 参与人 | 谈话参与人员 |
| reason | 事由/问题 | 谈话事由或问题类型 |
| attitude | 学生态度/情绪 | 学生在谈话中的表现 |
| analysis | 原因分析 | 问题产生的原因 |
| measures | 处理与辅导措施 | 采取的处理方式 |
| followup_plan | 后续跟进计划 | 后续的跟进安排 |

#### 交互说明
| 操作 | 说明 |
| :--- | :--- |
| 添加标签 | 在输入框输入内容，点击[添加]按钮，调用API新增明细记录 |
| 删除标签 | 点击标签行的[删除]按钮，调用API删除对应明细记录 |
| 列表展示 | 从数据库加载各类别下的所有明细数据展示 |

#### 功能说明
- 类别固定为6个，用户不能新增或删除类别
- 每个类别下的标签数量不限
- 添加/删除操作实时保存到数据库
- 保存成功后，"新增记录页"的复选框选项会自动更新
- 风险等级为固定选项（低/中/高），不在此页面配置

---

## 4. 数据库设计 (MySQL 8.0)

### 4.1 谈话记录表 (`talk_record`)


| 字段名 | 类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 主键 |
| student_name | VARCHAR(50) | NOT NULL | 学生姓名 |

| class_name | VARCHAR(50) | NOT NULL | 班级 |
| student_no | VARCHAR(50) | NOT NULL | 学号 |
| talk_time | DATETIME | NOT NULL | 谈话时间 |
| talk_place | VARCHAR(100) | NOT NULL | 谈话地点 |
| participants | VARCHAR(200) | NOT NULL | 参与人 |
| reason | VARCHAR(200) | NOT NULL | 事由/问题 |
| raw_text | TEXT | NOT NULL | 原始谈话片段 |
| form_data | JSON | NOT NULL | 结构化表单数据 |
| tags | JSON | | 快捷标签 |
| risk_level | TINYINT | DEFAULT 1 | 风险等级：1低 2中 3高 |
| followup_date | DATE | | 跟进日期 |
| generated_content | TEXT | | 生成的完整记录文本 |
| record_date | DATE | NOT NULL | 记录日期 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

```sql
CREATE TABLE talk_record (
    id INT PRIMARY KEY AUTO_INCREMENT,
    student_name VARCHAR(50) NOT NULL COMMENT '学生姓名',

    class_name VARCHAR(50) NOT NULL COMMENT '班级',
    student_no VARCHAR(50) NOT NULL COMMENT '学号',
    talk_time DATETIME NOT NULL COMMENT '谈话时间',
    talk_place VARCHAR(100) NOT NULL COMMENT '谈话地点',
    participants VARCHAR(200) NOT NULL COMMENT '参与人',
    reason VARCHAR(200) NOT NULL COMMENT '事由/问题',
    raw_text TEXT NOT NULL COMMENT '原始谈话片段',
    form_data JSON NOT NULL COMMENT '结构化表单数据',
    tags JSON COMMENT '快捷标签',
    risk_level TINYINT DEFAULT 1 COMMENT '风险等级：1低 2中 3高',
    followup_date DATE COMMENT '跟进日期',
    generated_content TEXT COMMENT '生成的完整记录文本',
    record_date DATE NOT NULL COMMENT '记录日期',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='谈话记录表';

-- 为常用查询字段添加索引
CREATE INDEX idx_student_name ON talk_record(student_name);
CREATE INDEX idx_record_date ON talk_record(record_date);
```



### 4.2 快捷标签类别表 (`quick_tag`)

> 主表，存储6个固定的标签类别

| 字段名 | 类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 主键（流水号） |
| category_code | VARCHAR(50) | NOT NULL, UNIQUE | 类别编码 |
| category_name | VARCHAR(100) | NOT NULL | 类别名称 |
| sort_order | INT | DEFAULT 0 | 排序顺序 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

```sql
CREATE TABLE quick_tag (
    id INT PRIMARY KEY AUTO_INCREMENT,
    category_code VARCHAR(50) NOT NULL UNIQUE COMMENT '类别编码',
    category_name VARCHAR(100) NOT NULL COMMENT '类别名称',
    sort_order INT DEFAULT 0 COMMENT '排序顺序',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='快捷标签类别表';

-- 初始化6个固定类别
INSERT INTO quick_tag (category_code, category_name, sort_order) VALUES
('participants', '参与人', 1),
('reason', '事由/问题', 2),
('attitude', '学生态度/情绪', 3),
('analysis', '原因分析', 4),
('measures', '处理与辅导措施', 5),
('followup_plan', '后续跟进计划', 6);
```

### 4.3 快捷标签明细表 (`quick_tag_detail`)

> 明细表，存储每个类别下的多个标签值，与主表是一对多关系

| 字段名 | 类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 主键（流水号） |
| tag_id | INT | NOT NULL, FOREIGN KEY | 关联 quick_tag.id |
| tag_value | VARCHAR(200) | NOT NULL | 标签值 |
| is_active | TINYINT | DEFAULT 1 | 是否启用：1启用 0禁用 |
| sort_order | INT | DEFAULT 0 | 排序顺序 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

```sql
CREATE TABLE quick_tag_detail (
    id INT PRIMARY KEY AUTO_INCREMENT,
    tag_id INT NOT NULL COMMENT '关联 quick_tag.id',
    tag_value VARCHAR(200) NOT NULL COMMENT '标签值',
    is_active TINYINT DEFAULT 1 COMMENT '是否启用：1启用 0禁用',
    sort_order INT DEFAULT 0 COMMENT '排序顺序',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    CONSTRAINT fk_quick_tag FOREIGN KEY (tag_id) REFERENCES quick_tag(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='快捷标签明细表';

-- 为tag_id添加索引
CREATE INDEX idx_tag_id ON quick_tag_detail(tag_id);

-- 初始化默认标签数据
-- 参与人 (tag_id = 1)
INSERT INTO quick_tag_detail (tag_id, tag_value, sort_order) VALUES
(1, '班主任', 1),
(1, '任课老师', 2),
(1, '家长', 3),
(1, '学生', 4);

-- 事由/问题 (tag_id = 2)
INSERT INTO quick_tag_detail (tag_id, tag_value, sort_order) VALUES
(2, '迟到', 1),
(2, '作业缺交', 2),
(2, '打架', 3),
(2, '情绪波动', 4),
(2, '课堂纪律', 5),
(2, '同伴冲突', 6);

-- 学生态度/情绪 (tag_id = 3)
INSERT INTO quick_tag_detail (tag_id, tag_value, sort_order) VALUES
(3, '诚恳', 1),
(3, '抵触', 2),
(3, '紧张', 3),
(3, '冷漠', 4),
(3, '配合', 5),
(3, '回避', 6);

-- 原因分析 (tag_id = 4)
INSERT INTO quick_tag_detail (tag_id, tag_value, sort_order) VALUES
(4, '作息管理', 1),
(4, '家庭原因', 2),
(4, '同伴影响', 3),
(4, '心理压力', 4),
(4, '学习困难', 5);

-- 处理与辅导措施 (tag_id = 5)
INSERT INTO quick_tag_detail (tag_id, tag_value, sort_order) VALUES
(5, '口头警告', 1),
(5, '家校沟通', 2),
(5, '制定计划', 3),
(5, '心理辅导', 4),
(5, '转介专业', 5);

-- 后续跟进计划 (tag_id = 6)
INSERT INTO quick_tag_detail (tag_id, tag_value, sort_order) VALUES
(6, '一周后复谈', 1),
(6, '持续观察', 2),
(6, '定期跟进', 3),
(6, '家长反馈', 4);
```

#### 表关系图
```
quick_tag (主表)              quick_tag_detail (明细表)
+----+---------------+        +----+--------+-----------+-----------+
| id | category_code |        | id | tag_id | tag_value | is_active |
+----+---------------+        +----+--------+-----------+-----------+
| 1  | participants  | ◄────┐ | 1  | 1      | 班主任     | 1         |
| 2  | reason        |      │ | 2  | 1      | 任课老师   | 1         |
| 3  | attitude      |      │ | 3  | 1      | 家长       | 1         |
| 4  | analysis      |      └─| 4  | 2      | 迟到       | 1         |
| 5  | measures      |        | 5  | 2      | 作业缺交   | 1         |
| 6  | followup_plan |        | ...| ...    | ...        | ...       |
+----+---------------+        +----+--------+-----------+-----------+
         │                            │
         └──────── 1 : N ─────────────┘
```

---

## 5. API 接口设计

### 5.1 接口规范

- **基础路径**: `/api/v1`
- **认证方式**: 无（免登录）

- **响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

### 5.2 接口列表

#### 记录模块


| 方法 | 路径 | 描述 | 认证 |
| :--- | :--- | :--- | :--- |
| POST | `/record` | 创建新记录 | ❌ |
| GET | `/record` | 获取记录列表 | ❌ |
| GET | `/record/:id` | 获取记录详情 | ❌ |
| DELETE | `/record/:id` | 删除记录 | ❌ |

#### 快捷标签模块

| 方法 | 路径 | 描述 | 认证 |
| :--- | :--- | :--- | :--- |
| GET | `/quick-tag` | 获取所有类别及其明细 | ❌ |
| GET | `/quick-tag/:id/details` | 获取指定类别的明细列表 | ❌ |
| POST | `/quick-tag/:id/detail` | 添加标签明细 | ❌ |
| DELETE | `/quick-tag/detail/:detailId` | 删除标签明细 | ❌ |


### 5.3 接口详情

#### 5.3.1 创建记录

```
POST /api/v1/record
```

**请求体**:
```json
{
  "student_name": "张三",
  "class_name": "7年级2班",
  "student_no": "202301",
  "talk_time": "2026-01-23 10:20:00",
  "talk_place": "办公室",
  "participants": "张老师、张三",
  "reason": "迟到",
  "raw_text": "今天又迟到…（原始谈话片段）",
  "form_data": {
    "key_facts": "连续三天迟到，原因是起床晚",
    "attitude": "诚恳",
    "analysis": "作息管理薄弱",
    "measures": "制定作息表并家校沟通",
    "followup_plan": "一周后复谈"
  },
  "tags": ["迟到", "作息管理", "家校沟通"],
  "risk_level": 1,
  "followup_date": "2026-01-30",
  "record_date": "2026-01-23"
}
```


#### 5.3.2 获取记录列表

```
GET /api/v1/record?page=1&size=10&name=张三
```

**查询参数**:
| 参数 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| page | number | ❌ | 页码，默认 1 |
| size | number | ❌ | 每页条数，默认 10 |
| name | string | ❌ | 学生姓名（模糊搜索） |

#### 5.3.3 获取所有类别及其明细

```
GET /api/v1/quick-tag
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "category_code": "participants",
      "category_name": "参与人",
      "sort_order": 1,
      "details": [
        { "id": 1, "tag_value": "班主任", "is_active": 1, "sort_order": 1 },
        { "id": 2, "tag_value": "任课老师", "is_active": 1, "sort_order": 2 },
        { "id": 3, "tag_value": "家长", "is_active": 1, "sort_order": 3 }
      ]
    },
    {
      "id": 2,
      "category_code": "reason",
      "category_name": "事由/问题",
      "sort_order": 2,
      "details": [
        { "id": 4, "tag_value": "迟到", "is_active": 1, "sort_order": 1 },
        { "id": 5, "tag_value": "作业缺交", "is_active": 1, "sort_order": 2 },
        { "id": 6, "tag_value": "打架", "is_active": 1, "sort_order": 3 }
      ]
    }
  ]
}
```

#### 5.3.4 获取指定类别的明细列表

```
GET /api/v1/quick-tag/:id/details
```

**路径参数**:
| 参数 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| id | number | ✅ | 类别ID（quick_tag.id） |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "category": {
      "id": 2,
      "category_code": "reason",
      "category_name": "事由/问题"
    },
    "details": [
      { "id": 4, "tag_value": "迟到", "is_active": 1, "sort_order": 1 },
      { "id": 5, "tag_value": "作业缺交", "is_active": 1, "sort_order": 2 },
      { "id": 6, "tag_value": "打架", "is_active": 1, "sort_order": 3 }
    ]
  }
}
```

#### 5.3.5 添加标签明细

```
POST /api/v1/quick-tag/:id/detail
```

**路径参数**:
| 参数 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| id | number | ✅ | 类别ID（quick_tag.id） |

**请求体**:
```json
{
  "tag_value": "情绪波动"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "添加成功",
  "data": {
    "id": 7,
    "tag_id": 2,
    "tag_value": "情绪波动",
    "is_active": 1,
    "sort_order": 4,
    "create_time": "2026-01-24 15:00:00"
  }
}
```

#### 5.3.6 删除标签明细

```
DELETE /api/v1/quick-tag/detail/:detailId
```

**路径参数**:
| 参数 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| detailId | number | ✅ | 明细ID（quick_tag_detail.id） |

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

---

## 6. 部署方案

### 6.1 Docker Compose 配置

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: talk-record-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123456
      MYSQL_DATABASE: talk_record
      MYSQL_USER: app
      MYSQL_PASSWORD: app123456
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  backend:
    build: ./backend
    container_name: talk-record-backend
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: mysql://app:app123456@mysql:3306/talk_record
    depends_on:
      - mysql


volumes:
  mysql_data:
```

### 6.2 环境变量配置

| 变量名 | 描述 | 示例值 |
| :--- | :--- | :--- |
| DATABASE_URL | 数据库连接字符串 | mysql://user:pass@host:3306/db |


---

## 7. 开发计划

| 阶段 | 任务 | 预估工时 |
| :--- | :--- | :--- |
| **Phase 1** | 项目初始化、数据库搭建 | 1天 |
| **Phase 2** | 后端 API 开发（记录） | 2天 |

| **Phase 3** | 前端页面开发（3个页面） | 3天 |

| **Phase 4** | 联调测试、Bug 修复 | 1天 |
| **Phase 5** | 部署上线 | 1天 |

**总计**: 约 **8 个工作日**

---

## 附录

### A. 页面导航流程

```
启动小程序
    │
    ▼
┌─────────┐
│ 记录列表 │ ◄──────────────────┐
└────┬────┘                    │
    │ 点击新增                  │
    ▼                          │
┌─────────┐                    │
│ 新增记录 │───────────────────┤ 保存成功
└────┬────┘                    │
    │                          │
    ▼                          │
┌─────────┐                    │
│ 记录列表 │                    │
└────┬────┘                    │
    │ 点击列表项                 │
    ▼                          │
┌─────────┐                    │
│ 记录详情 │                    │
└─────────┘                    │
                               │
                               │
┌──────────────────────────────┴────────────────────────────────┐
│                     底部导航栏（Tab Bar）                       │
├─────────────────┬─────────────────┬─────────────────┬─────────┤
│    记录列表      │    新增记录      │   快捷标签配置   │         │
└─────────────────┴─────────────────┴─────────────────┴─────────┘
                                      │
                                      ▼
                              ┌───────────────┐
                              │ 快捷标签配置页 │
                              │ (配置复选框选项)│
                              └───────────────┘
```

### B. 错误码定义

| 错误码 | 描述 |
| :--- | :--- |
| 200 | 成功 |
| 400 | 请求参数错误 |

| 403 | 无权限访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
